<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>26A Issues Tracking Report</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { background:#f3f6f9; }
    .card-ghost { background: #fff; border-radius: 8px; box-shadow: 0 6px 18px rgba(16,24,40,.06); }
    .table-left { max-width: 520px; }
    .chart-card { min-height: 400px; height: 100%; }
    .section-title { font-weight:600; color:#d43f3f; }
    .note { font-size:0.85rem; color:#8a8f98; }
    .legend-dot { width:10px; height:6px; display:inline-block; margin-right:6px; border-radius:2px; }
  </style>
</head>
<body>
  <div class="container-fluid p-4">
    <!-- Page Title -->
    <div class="text-center mb-4">
      <h3 class="fw-bold">üìä 26A Release Issue Tracking Report</h3>
      <p class="text-muted">This report summarizes issues encountered during recent testing, visualized by type and date.</p>
      <p class="small">üõ†Ô∏è <strong>Build Regression and Performance Testing Timeline:</strong> 01 October ‚Äì present</p>
    </div>

    <!-- Stats -->
    <div class="row g-4 mb-4 justify-content-center">
      <div class="col-md-3">
        <div class="card card-ghost text-center p-3">
          <h6 class="text-uppercase text-muted mb-2">Open Issues</h6>
          <h3 id="openIssuesCount" class="fw-bold text-warning">0</h3>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card card-ghost text-center p-3">
          <h6 class="text-uppercase text-muted mb-2">Total Closed</h6>
          <h3 id="closedIssuesCount" class="fw-bold text-success">0</h3>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Table -->
      <div class="col-lg-4">
        <div class="card card-ghost p-3 table-left">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Datewise Issues</h5>
            <!-- <small class="text-muted">Recent 2 weeks</small> -->
          </div>
          <table id="issuesTable" class="table table-sm table-bordered text-center">
            <thead class="table-dark">
              <tr><th>Date</th><th>New</th><th>Closed</th></tr>
            </thead>
            <tbody id="issuesBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Chart -->
      <div class="col-lg-8">
        <div class="card card-ghost p-3 chart-card">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">New vs Closed Issues</h5>
            <div>
              <span class="legend-dot" style="background:#d69d2f"></span> New Issues
              <span class="mx-2 legend-dot" style="background:#2f8e3c"></span> Closed Issues
            </div>
          </div>
          <div class="pt-3" style="height:350px">
            <canvas id="issuesChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Bugs -->
      <div class="col-lg-6">
        <div class="card card-ghost p-4">
          <h6 class="section-title"><i class="fa-solid fa-bug me-2"></i>Open Important Bugs</h6>
          <p class="note">These bugs are high-priority and remain unresolved. Immediate attention is required:</p>
          <ul id="openBugs" class="mb-0"></ul>
          <p class="note mt-2"><em>Note: This list is updated based on severity and impact.</em></p>
        </div>
      </div>

      <!-- Pending -->
      <div class="col-lg-6">
        <div class="card card-ghost p-4">
          <h6 class="section-title" style="color:#f6b200"><i class="fa-solid fa-pencil me-2"></i>Pending Test Coverage</h6>
          <p class="note">Items not yet fully covered by testing:</p>
          <ul id="pendingList" class="mb-0"></ul>
          <p class="note mt-2"><em>Note: Some items may be partially tested and need revalidation.</em></p>
        </div>
      </div>
    </div>
  </div>

  <!-- JS libs -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    // Load CSV helper
    async function loadCSV(file) {
      const response = await fetch(file);
      const text = await response.text();
      return Papa.parse(text, { header: true }).data.filter(r => Object.values(r).some(v => v));
    }

    async function initDashboard() {
      // --- 1. Load issues CSV ---
      const issues = await loadCSV("dateClosevsNew.csv");

      // Table
      const tbody = document.getElementById('issuesBody');
      tbody.innerHTML = "";
      issues.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.date}</td><td>${r.new}</td><td>${r.closed}</td>`;
        tbody.appendChild(tr);
      });

      // Counts
      const totalNew = issues.reduce((sum, r) => sum + parseInt(r.new || 0), 0);
      const totalClosed = issues.reduce((sum, r) => sum + parseInt(r.closed || 0), 0);
      document.getElementById("closedIssuesCount").textContent = totalClosed;
      document.getElementById("openIssuesCount").textContent = totalNew - totalClosed;

      // Chart
      const ctx = document.getElementById('issuesChart');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: issues.map(r => r.date),
          datasets: [
            { label: 'New Issues', data: issues.map(r => parseInt(r.new || 0)), borderColor: '#d69d2f', backgroundColor: 'rgba(214,157,47,0.08)', tension: 0.4, fill: true },
            { label: 'Closed Issues', data: issues.map(r => parseInt(r.closed || 0)), borderColor: '#2f8e3c', backgroundColor: 'rgba(47,142,60,0.08)', tension: 0.4, fill: true }
          ]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } } }
      });

      // DataTable
      $('#issuesTable').DataTable({ paging:false, info:false, searching:false, order:[[0,'desc']] });

      // --- 2. Load bugs CSV ---
      const bugs = await loadCSV("bugs.csv");
      const bugsEl = document.getElementById('openBugs');
      bugsEl.innerHTML = "";
      bugs.forEach(b => {
        const li = document.createElement('li');
        li.textContent = b.bug;
        bugsEl.appendChild(li);
      });

      // --- 3. Load pending CSV ---
      const pending = await loadCSV("pending.csv");
      const pendEl = document.getElementById('pendingList');
      pendEl.innerHTML = "";
      pending.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.item;
        pendEl.appendChild(li);
      });
    }

    initDashboard();
  </script>
</body>
</html>
